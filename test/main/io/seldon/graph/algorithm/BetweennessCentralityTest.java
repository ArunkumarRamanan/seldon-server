/*
 * Seldon -- open source prediction engine
 * =======================================
 *
 * Copyright 2011-2015 Seldon Technologies Ltd and Rummble Ltd (http://www.seldon.io/)
 *
 * ********************************************************************************************
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * ********************************************************************************************
 */

package io.seldon.graph.algorithm;

import io.seldon.graph.AdjacencyGraph;
import org.junit.After;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.*;

/**
 * @author philipince
 *         Date: 16/12/2013
 *         Time: 10:09
 */
public class BetweennessCentralityTest {

    private static int[][] philAdjacencyGraph;
    private AdjacencyGraph philGraph;
    private static int[][] dylanAdjacencyGraph = LargeFacebookUser.read();
    private AdjacencyGraph dylanGraph;

    @Before
    public void setUp() throws Exception {
        System.out.println("Setting up test");
        philAdjacencyGraph = new int[][]{{3,4,8,17,18,104,162,182,188,200,202,211,218,234,271},{243,262},{10,48,206,207,
                208},{0,4,6,7,8,9,18,22,104,155,162,164,182,183,185,186,189,196,202,211,218,
                245,277},{0,3,6,8,9,17,18,104,155,162,164,182,183,185,186,188,189,196,200,202,
                211,218,234,245,271,277},{13,30,60,62,86,88,98,114,169,174,193},{3,4,7,8,9,18,
                155,185,188,196,202,218,245,271,277},{3,6,8,10,218,277},{0,3,4,6,7,9,17,18,
                182,183,185,188,196,202,218,245},{3,4,6,8,196,245},{2,7,14,30,62,179,193,216,
                228,246,269},{113,119,123,133},{224},{5,16,207,235},{10,179,180,187,190,197,198,
                205,206,207,208,212,213,215,216,224,228,229,236,237,238,240,246,248,253,254,255,
                257,269},{30,48,62,103,104,125,147,172,181,194,210,214,260,263,268,275,276},{13,
                205},{0,4,8,18,104,155,182,183,185,188,189,196,200,202,211,218,271},{0,3,4,6,
                8,17,104,162,182,183,185,186,188,189,196,202,211,218,271},{21,32,39,40,41,42,
                48,54,62,64,66,76,78,89,90,91,94,96,102,107,115,142,143,152,153,167,176},{21,
                23,24,25,32,33,37,38,39,41,42,43,46,47,48,51,52,53,54,55,57,58,59,61,63,64,
                65,71,72,76,77,78,80,85,89,90,94,95,96,101,102,103,105,107,108,113,115,120,
                126,130,134,135,137,138,141,142,145,146,148,152,161,163,166,170,171,201,278},{19,
                20,22,28,31,32,33,37,38,40,41,42,43,45,47,48,51,52,53,54,55,56,61,62,63,68,
                69,71,72,73,76,77,78,79,80,83,85,87,91,92,94,95,96,101,102,103,104,107,108,
                109,110,111,113,115,116,117,119,120,121,126,128,134,135,138,139,141,142,143,145,
                146,148,150,152,153,154,157,158,159,161,163,165,166,167,170,171,178,201,230,233,
                278},{3,21,33,47,48,51,53,57,63,68,102,104,134,145,150,182,202},{20,24,25,26,
                29,37,38,48,52,54,61,67,71,72,76,94,103,106,121,129,130,136,137,143,146,152,
                156,158,174,278},{20,23,30,37,42,62,64,70,80,89,90,91,92,93,103,120,129,132,
                136,141,149,151,172,278},{20,23,27,28,37,39,42,46,54,72,76,78,80,102,103,106,
                109,121,126,129,130,137,152,153},{23,27,42,48,61,70,72,103,117,129,137,143,178,
                278},{25,26,28,34,35,37,46,48,56,61,62,72,76,83,89,90,103,104,106,127,129,134,
                137,141,143,147,167,278},{21,25,27,33,37,38,41,42,46,48,61,62,63,64,72,78,80,
                103,104,106,109,129,130,143,147,152,167},{23,54,61,67,68,71,72,76,94,106,107,
                112,115,117,129,132,137,141,143,227,278},{5,10,15,24,32,33,35,39,40,44,46,47,
                48,49,52,60,62,63,64,65,70,78,82,86,89,90,102,104,109,114,121,135,136,147,150,
                159,160,165,168,169,172,174,193,198,210,216,228,242,269,278},{21,32,43,45,48,50,
                55,56,62,68,69,73,75,76,77,79,83,85,95,101,104,110,115,117,121,134,137,139,
                141,142,145,146,148,151,154,157,158,165,170,230,278},{19,20,21,30,31,33,38,39,
                40,41,42,43,45,48,52,54,55,56,64,65,66,67,71,72,73,75,76,77,78,79,82,85,86,
                87,91,94,95,96,101,103,104,107,108,109,110,115,117,121,134,141,142,143,145,146,
                147,150,151,152,153,157,158,159,165,166,167,170,171,225,226,230,278},{20,21,22,
                28,30,32,38,39,40,41,47,48,51,52,53,55,57,59,62,64,65,68,69,76,78,81,82,86,
                94,95,99,102,113,115,116,119,126,128,131,134,135,140,148,150,152,154},{27,35,36,
                44,47,48,50,51,53,55,59,62,65,67,68,76,78,92,104,113,115,117,132,133,134,135,
                147,148,157,233},{27,30,34,36,39,44,47,51,55,59,62,65,74,92,99,113,131,133,
                135,143,153,165,193,230,233},{34,35,44,47,48,55,60,65,68,76,92,113,115,117,121,
                134,148,154},{20,21,23,24,25,27,28,38,42,46,49,54,56,61,64,66,71,72,80,89,94,
                100,103,104,106,107,109,121,129,130,134,136,137,143,147,148,152,166,278},{20,21,
                23,28,32,33,37,43,45,48,53,55,57,59,62,63,65,67,68,69,74,75,76,77,78,83,84,
                95,97,99,101,102,104,110,113,115,117,126,128,130,134,135,140,141,143,144,146,
                147,148,151,153,154,157,158,159,166,170,210,225,230},{19,20,25,30,32,33,35,40,
                41,42,48,51,52,54,62,64,71,76,78,81,83,91,94,95,96,97,102,107,111,113,115,
                121,126,141,146,147,152,153,158,161,165,167,171,201,227},{19,21,30,32,33,39,41,
                44,45,46,47,48,49,52,54,62,64,65,76,78,80,82,86,91,94,97,102,104,106,107,109,
                115,121,127,128,147,148,150,152,153,165,167,171},{19,20,21,28,32,33,39,40,42,
                45,46,48,52,54,56,64,66,71,72,76,78,81,82,91,94,95,96,102,104,105,107,109,
                115,121,122,124,128,140,141,143,145,148,150,152,153,158,160,167,278},{19,20,21,
                24,25,26,28,32,37,39,41,46,48,49,52,54,61,64,69,70,71,72,76,78,80,81,94,96,
                100,101,102,103,105,107,109,115,116,121,127,128,129,130,132,141,143,145,146,148,
                150,152,153,158,165,171,178,227,278},{20,21,31,32,55,68,73,75,76,77,79,83,85,
                97,101,104,110,115,117,134,142,143,145,146,154,157,158,159,170,38},{30,34,35,36,
                40,47,53,59,62,63,79,84,95,108,113,116,135,148,170},{21,31,32,38,40,41,48,52,
                55,56,63,66,68,75,76,77,79,83,84,87,94,95,101,103,104,110,111,115,117,120,122,
                127,129,134,137,138,141,143,144,146,147,148,151,152,154,158,159,165,167,170,171,
                221,225},{20,25,27,28,30,37,40,41,42,48,52,61,62,63,65,70,72,78,80,103,104,
                106,109,130,134,137,143,147,152,168,210,278},{20,21,22,30,33,34,35,36,40,44,48,
                53,59,62,63,65,69,74,76,77,81,82,84,86,95,99,104,112,113,115,116,128,134,135,
                146,147,148,154,170,221},{2,15,19,20,21,22,23,26,27,28,30,31,32,33,34,36,38,
                39,40,41,42,45,46,47,51,52,54,55,56,57,58,59,61,62,63,64,65,66,67,68,69,71,
                72,74,76,77,78,79,81,82,86,87,90,94,95,99,101,102,103,104,105,106,107,108,109,
                110,112,115,116,117,118,121,124,126,127,128,131,134,135,137,138,140,141,143,146,
                147,150,152,153,154,156,158,159,160,161,165,166,167,168,169,170,172,173,194,207,
                210,214,221,225,226,253,260,263,264,268,275,276,278},{30,37,40,42,54,65,67,70,
                71,72,76,84,94,95,96,100,103,106,121,129,132,141,152,167,171,233},{31,34,55,67,
                115,133,139,148,207,222},{20,21,22,33,34,35,39,48,52,54,62,65,71,76,78,79,85,
                94,95,105,108,115,119,121,124,131,134,135,138,141,142,148,152,153,161,278},{20,
                21,23,30,32,33,39,40,41,42,45,46,48,51,54,61,62,64,71,72,76,78,81,94,95,97,
                102,103,106,107,109,115,121,122,124,126,127,137,141,142,143,147,148,152,153,158,
                161,171,225,227,278},{20,21,22,33,34,38,44,47,55,59,65,68,69,71,74,76,92,95,
                96,99,103,104,111,113,115,116,118,121,126,128,134,135,140,141,148,150,152,154,
                157,221},{19,20,21,23,25,29,32,37,39,40,41,42,48,49,51,52,56,61,64,66,67,69,
                71,72,76,77,78,79,80,83,84,85,87,89,90,91,94,95,96,101,102,103,104,106,107,
                108,109,115,120,121,122,126,131,132,134,137,138,141,142,143,145,146,148,150,152,
                153,157,158,161,165,166,167,170,171,201,278},{20,21,31,32,33,34,35,36,43,38,45,
                48,50,53,56,59,62,63,65,66,67,68,69,75,76,77,79,83,85,94,99,101,103,110,111,
                113,115,117,118,121,126,131,134,135,141,142,143,146,147,148,150,151,152,154,157,
                158,159,170,225,230,278},{21,27,31,32,37,41,45,48,54,55,60,61,64,66,67,68,71,
                72,76,77,83,87,94,95,96,101,104,106,113,115,117,119,120,121,127,134,137,138,
                141,143,146,148,151,152,154,156,157,158,160,166,167,171,201,225},{20,22,33,38,
                48,62,63,65,83,84,104,111,118,134,135,140,147,154,166,172},{20,48,62,76,105,
                147,173},{20,33,34,35,38,44,47,48,53,55,62,65,69,74,99,104,113,115,116,118,
                121,126,128,134,135,140,147,148,150,152,165,221,278},{5,30,36,56,88,91,98,113,
                114,174},{20,21,23,26,27,28,29,37,42,46,48,52,54,56,64,70,71,72,76,92,94,96,
                103,106,107,115,121,124,130,137,142,143,145,151,152,156,158,166,174,278},{5,10,
                15,19,21,24,27,28,30,31,33,34,35,38,39,40,44,46,47,48,51,52,55,57,58,59,63,
                64,65,70,71,76,77,78,80,82,84,86,89,90,91,92,93,95,102,103,104,105,108,109,
                112,115,116,117,121,122,127,128,130,132,134,135,138,140,141,146,147,148,149,150,
                152,154,158,159,160,161,165,168,169,172,173,191,210,221,225,227,263},{20,21,22,
                28,30,38,44,45,46,47,48,55,57,62,65,68,74,76,78,83,84,94,99,101,103,104,109,
                111,115,117,128,134,135,140,142,143,144,145,147,149,150,154,157,158,159,166,167,
                171,172,201,210},{19,20,24,28,30,32,33,37,39,40,41,42,48,52,54,56,61,62,65,
                66,70,76,78,80,83,89,90,91,92,93,94,96,97,102,103,106,109,111,121,126,131,132,
                136,138,140,141,143,145,149,151,152,153,167,171},{20,30,32,33,34,35,36,38,40,
                46,47,48,49,51,53,55,57,59,62,63,64,68,69,71,74,75,76,78,81,82,83,84,86,95,
                99,102,104,108,113,115,116,118,126,128,133,134,135,140,141,143,147,148,150,152,
                154,158,160,166,167,171,172,210,221,230,278},{19,32,37,41,45,48,54,55,56,64,70,
                76,93,101,104,117,120,121,122,132,141,142,144,151,152,153,157,167},{23,29,32,34,
                38,48,49,50,54,55,56,71,75,76,94,105,106,112,113,115,117,121,126,137,139,141,
                143,148,151,152,153,154,165,227,278},{21,22,29,31,33,34,36,43,38,45,48,53,55,
                56,63,65,70,71,75,76,77,79,83,95,96,101,102,104,108,110,115,117,121,134,137,
                141,142,143,145,146,147,148,151,152,154,157,158,166,170,225,230},{21,31,33,38,
                42,47,48,53,54,55,59,65,74,76,94,95,99,104,113,115,118,121,126,128,134,135,
                140,143,146,147,148,150,152,157,278},{24,26,30,42,46,49,61,62,64,66,68,71,76,
                80,89,90,91,92,93,95,96,100,101,109,117,118,127,128,137,141,146,151,154},{20,
                21,23,29,32,37,39,41,42,48,49,51,52,53,54,56,61,62,65,67,68,70,75,76,77,78,
                79,80,81,82,85,86,87,89,90,94,95,96,100,101,102,103,104,105,106,107,108,112,
                115,117,119,121,124,126,127,128,135,137,138,141,142,143,144,146,151,152,153,154,
                157,158,161,165,170,171,173,225,227,278},{20,21,23,25,26,27,28,29,32,37,41,42,
                46,48,49,52,54,56,61,76,80,89,94,103,104,106,121,127,129,130,137,139,143,145,
                166,278},{21,31,32,43,75,76,77,79,85,101,110,115,117,134,142,145,146,157,170,
                230},{35,38,47,48,53,59,63,65,69,76,84,95,99,104,113,116,118,126,128,134,135,
                139,140,147,148,150,154,221},{31,32,43,38,45,55,73,65,67,68,71,76,77,79,84,87,
                97,101,108,110,115,117,121,127,131,134,138,141,142,143,144,146,147,151,152,154,
                157,158,159,161,165,170,225,230,278},{19,20,21,23,25,27,29,31,32,33,34,36,43,
                38,39,40,41,42,45,47,48,49,51,52,53,54,55,56,58,73,61,62,63,64,65,66,67,68,
                69,70,71,72,74,75,77,79,81,82,83,85,86,87,94,95,96,97,99,101,102,103,104,105,
                106,107,108,109,110,115,117,119,121,126,127,128,129,131,134,135,137,138,141,142,
                143,144,145,146,147,148,150,151,152,153,154,157,158,159,161,165,166,167,170,171,
                178,221,225,227,230,233,278},{20,21,31,32,43,38,45,47,48,54,55,56,73,62,68,71,
                75,76,79,85,87,94,95,96,101,103,104,108,110,115,117,121,127,134,137,138,141,
                142,143,145,146,148,150,151,152,154,157,158,159,165,170,225,226,230,278},{19,20,
                21,25,28,30,32,33,34,38,39,40,41,42,46,48,51,52,54,62,63,64,65,71,80,82,86,
                87,94,95,96,102,104,105,106,108,109,115,116,119,120,121,122,124,126,128,131,135,
                137,141,145,147,152,153,158,159,160,163,166,168,221,225},{21,31,32,43,44,45,48,
                51,54,55,73,68,71,75,76,77,95,97,101,108,110,113,115,117,119,121,131,134,141,
                142,145,146,152,154,157,158,159,165,170,225,230,233,278},{20,21,24,25,28,37,40,
                42,46,54,62,64,70,71,72,78,83,89,90,91,92,93,100,102,103,109,111,120,130,136,
                149,152,153,278},{33,39,41,42,47,48,52,65,71,76,94,95,96,99,102,115,118,121,
                126,131,135,137,141,143,147,152,153,221,278},{30,32,33,40,41,47,48,62,65,71,76,
                78,86,102,109,115,122,138,148,150,160,225},{21,27,31,43,38,39,45,54,55,56,57,
                63,64,65,68,76,80,94,97,101,102,103,104,111,115,117,121,132,134,143,146,147,
                151,157,158,159,166,171,230,278},{38,44,45,47,49,54,57,62,63,65,74,75,99,100,
                103,104,116,118,121,128,135,140,147,150,154,159,166,167,221,226},{20,21,31,32,
                43,51,54,55,73,71,76,77,95,101,104,115,119,121,134,138,142,143,145,146,148,157,
                158,159,170,176},{5,30,32,33,40,47,48,62,65,71,76,78,82,96,99,102,108,109,122,
                128,135,148,150,152,160,169,173,225},{21,32,45,48,54,56,71,75,76,77,78,94,95,
                96,101,107,108,115,121,134,141,145,146,150,152,157,158,161,278},{5,60,98,114},
                {19,20,24,27,30,37,54,62,64,70,71,72,80,90,91,92,93,94,100,107,120,132,136,
                        141,149,153,156,165,168,171,178,278},{19,20,24,27,30,48,54,62,64,70,71,80,89,
                91,92,93,94,96,107,120,121,132,136,141,149,153,171,178,278},{19,21,24,32,39,40,
                41,54,60,62,64,70,80,89,90,92,93,94,107,120,122,132,136,141,152,153,163,174,
                178,278},{21,24,34,35,36,53,61,62,64,70,80,89,90,91,93,103,113,120,121,132,
                134,136,141,149,151,156,159,163,165,175,178,278},{24,62,64,66,70,80,89,90,91,
                92,120,132,136,141,149,151,163,233},{19,20,21,23,29,32,33,37,39,40,41,42,45,
                48,49,51,52,54,55,56,61,63,64,67,69,71,72,76,77,78,81,83,87,89,90,91,95,96,
                101,102,103,104,106,107,109,111,115,120,121,122,126,127,132,137,138,141,142,143,
                145,146,148,149,152,153,157,158,159,161,163,166,167,171,178,227,278},{20,21,31,
                32,33,38,39,41,44,45,47,48,49,51,52,53,54,56,62,65,68,69,70,71,74,76,77,78,
                79,81,85,87,94,96,99,101,104,105,107,108,110,113,115,117,118,119,121,126,127,
                128,131,135,137,138,141,142,143,145,146,148,150,152,153,154,157,158,161,165,170,
                225,278},{19,20,21,32,39,41,42,49,53,54,56,61,64,68,70,71,76,77,78,81,86,87,
                90,94,95,107,108,115,121,126,141,143,145,146,152,153,158,171,225},{43,38,39,40,
                52,64,75,76,79,83,104,107,115,117,134,146,147,151,158,163,170,227},{5,60,88,
                114,174},{33,35,38,47,48,53,55,59,63,65,69,74,76,81,84,86,95,104,113,115,116,
                118,121,126,128,134,135,139,140,147,148,150,158,167,221,278},{37,42,49,70,71,80,
                84,89,129,132,163},{20,21,31,32,43,38,42,45,48,54,55,56,73,63,66,68,70,71,75,
                76,77,79,83,85,87,94,95,102,104,108,110,111,115,117,120,121,127,129,134,137,
                138,141,142,143,145,146,148,150,151,152,153,154,157,158,161,166,170,171,201,225,
                230,278},{19,20,21,22,25,30,33,38,39,40,41,42,48,52,54,62,64,65,68,71,76,78,
                82,80,81,83,86,94,101,105,109,111,115,119,121,126,134,142,146,147,148,150,152,
                153,154,160,278},{15,20,21,23,24,25,26,27,28,32,37,42,45,46,48,49,52,53,54,
                55,61,62,63,64,71,72,76,77,80,83,84,92,94,104,106,107,109,111,117,127,129,130,
                134,136,137,142,143,145,146,147,151,152,153,158,159,172,227,278},{0,3,4,15,17,
                18,21,22,27,28,30,31,32,34,37,43,38,40,41,45,46,47,48,53,54,56,57,59,62,63,
                65,66,68,69,71,72,74,76,77,78,83,84,85,94,95,97,99,101,103,107,109,111,115,
                116,118,121,127,129,130,134,135,137,140,141,142,143,146,147,148,150,151,152,154,
                155,157,158,159,166,167,168,172,176,177,178,182,186,189,196,202,209,210,211,218,
                221,223,225,226,230,245,263,276,278},{20,41,42,48,51,58,62,67,71,76,78,95,102,
                115,118,121,126,141,152,153,158,278},{23,25,27,28,29,37,40,46,48,49,52,54,56,
                61,64,67,71,72,76,78,94,103,107,109,121,130,137,141,143,145,146,152,153,278},
                {19,20,21,29,32,37,39,40,41,42,48,52,54,61,71,76,87,89,90,91,94,95,96,97,
                        103,104,106,115,120,121,122,126,141,142,145,149,152,153,158,163,166,171,278},{20,
                21,32,44,48,51,54,62,65,68,71,75,76,77,78,79,86,87,95,96,101,115,117,121,124,
                134,141,142,146,152,154,157,161,165,170,225,230},{21,25,28,30,32,37,40,41,42,
                46,48,52,54,62,63,64,70,76,78,82,80,86,94,102,103,104,106,115,121,126,143,145,
                146,147,148,152,153,158,168,178,210,233,278},{21,31,32,43,38,45,48,55,73,68,75,
                76,77,79,95,101,115,117,134,141,142,144,145,146,147,154,157,158,159,165,170,225,
                230},{21,39,45,53,55,57,63,64,80,83,94,101,102,103,104,120,127,129,143,148,152,
                158,159,171,278},{29,47,48,62,67,71,117,121,131,148,154,157,166,174,278},{11,20,
                21,33,34,35,36,38,39,44,47,53,55,56,59,60,65,67,69,74,79,92,95,99,117,118,
                126,128,134,148,154,278},{5,30,60,88,98,174,227},{19,20,21,29,31,32,33,34,36,
                43,38,39,40,41,42,45,47,48,50,51,52,53,54,55,56,59,73,61,62,63,65,67,68,69,
                71,75,76,77,78,79,82,81,83,85,87,94,95,96,97,99,101,102,104,105,107,108,109,
                110,117,121,126,127,128,131,134,136,137,138,141,142,143,145,146,147,148,150,152,
                153,154,157,158,159,160,161,165,166,170,171,173,225,230,278},{21,33,42,44,47,48,
                53,59,62,65,74,78,84,99,104,118,120,128,134,135,140,147,148,150,221},{21,26,29,
                31,32,34,36,43,38,45,48,55,56,73,62,63,66,67,68,70,71,75,76,77,79,83,95,97,
                101,103,112,108,110,113,115,118,119,121,126,127,128,131,134,137,141,142,143,144,
                145,146,147,151,152,154,156,157,158,159,161,165,170,225,227,230,278},{48,53,55,
                57,59,65,69,70,74,81,84,95,99,104,105,113,116,117,126,128,134,135,140,147,148,
                150,221},{11,21,33,51,56,71,76,78,79,85,95,102,117,121,126,128,139,141,142,158,
                159,160,161,165,170},{20,21,24,45,54,56,66,78,80,89,90,91,92,93,94,101,107,
                111,116,132,141,149,151,152,163,166,178},{21,23,25,30,31,32,36,37,39,40,41,42,
                48,49,51,52,53,54,55,56,59,61,62,64,66,67,68,69,71,72,75,76,77,78,79,81,83,
                84,85,87,90,92,94,95,96,99,101,102,104,105,106,112,107,108,109,115,117,119,122,
                126,128,129,130,135,137,141,142,143,145,146,147,148,150,151,152,153,154,157,158,
                159,160,161,163,165,170,171,174,178,221,225,233,278},{41,45,52,54,62,66,78,82,
                86,91,94,107,121,134,158,160,163,167},{11},{41,48,51,52,61,71,78,108,137,142,
                152,158,225},{15,147,201},{20,21,25,33,38,39,48,52,53,54,55,59,64,65,67,69,71,
                74,76,78,81,94,95,96,99,102,105,107,109,113,115,117,118,119,121,128,131,135,
                140,141,148,150,152,153},{27,40,42,45,48,52,56,62,70,71,72,75,76,77,94,95,101,
                103,104,111,115,117,129,137,141,143,147,152,156,158,168,171,174,225,227,278},{21,
                33,38,40,41,42,47,48,53,59,62,63,65,69,70,71,74,76,78,84,86,95,99,113,115,
                116,117,118,119,121,126,134,135,140,141,147,148,150,152,154,158,221},{23,24,25,
                26,27,28,29,37,42,45,49,72,76,100,101,103,104,111,121,127,136,137,141,143,156,
                159,176,177,278},{20,23,25,28,37,38,42,46,61,62,72,80,103,104,106,121,147,278},
                {33,35,48,51,54,55,64,75,76,78,79,81,95,112,115,117,126,134,141,152,153,154,
                        278},{24,29,34,42,49,54,62,64,66,83,89,90,91,92,93,94,100,120,136,141,149,151,
                163,165,178,233,278},{11,34,35,50,65,139},{20,21,22,27,31,32,33,34,36,37,43,
                38,45,46,47,48,51,53,54,55,56,57,59,73,62,63,65,68,69,74,75,76,77,79,83,85,
                87,92,97,99,101,102,103,104,108,110,113,115,116,117,118,122,128,131,135,137,140,
                142,143,144,145,146,147,148,150,151,152,154,157,158,159,164,166,170,201,210,221,
                225,230,278},{20,21,30,33,34,35,38,44,47,48,51,53,55,57,59,62,63,65,69,71,74,
                76,78,81,84,86,95,99,104,116,118,121,126,128,134,140,141,147,148,150,152,154,
                167,169,221},{23,24,30,37,64,80,89,90,91,92,93,103,115,129,132,149,151,172},
                {20,23,25,26,27,29,31,37,45,46,48,52,54,56,61,67,68,70,71,72,76,77,78,81,94,
                        95,101,103,104,106,115,117,121,124,127,129,134,141,142,143,146,152,154,158,227,
                        278},{20,21,45,48,51,54,56,62,64,71,75,76,77,82,85,94,95,101,115,141,145,152,
                153,158,165,170,278},{21,31,50,67,72,74,99,119,133,145,176,177,222},{33,38,41,
                48,53,57,59,62,63,64,65,69,74,84,99,104,116,118,126,128,134,135,147,148,150,
                152,221},{20,21,24,27,29,31,32,38,39,41,42,45,48,49,51,52,53,54,55,56,62,64,
                65,66,67,68,70,71,75,76,77,78,79,81,87,89,90,91,92,93,94,95,96,101,104,105,
                106,107,108,110,115,117,119,120,121,126,127,128,129,131,132,135,137,138,142,143,
                144,146,148,149,151,152,153,154,157,158,161,165,170,171,233,278},{19,20,21,31,
                32,43,51,52,54,55,73,61,63,66,68,71,75,76,77,79,85,94,95,101,102,103,104,107,
                108,110,115,117,119,121,124,134,137,141,143,145,146,148,152,153,154,156,157,158,
                159,165,170,230,278},{19,21,23,26,27,28,29,32,35,37,43,38,41,42,45,46,48,52,
                54,55,56,61,63,64,65,67,68,69,71,72,75,76,77,81,83,85,94,95,96,101,103,104,
                106,109,111,115,117,121,127,129,134,137,141,142,144,145,146,148,151,152,153,154,
                156,157,158,159,161,165,166,167,170,171},{38,45,63,66,71,75,76,110,117,134,141,
                143,146,147,151,154,158,225,233},{20,21,22,31,32,43,41,42,54,73,61,63,64,68,
                72,76,77,78,79,85,87,94,95,96,101,103,106,107,109,110,115,117,121,134,138,139,
                142,143,146,148,150,152,153,156,157,158,159,166,170,171,178,201,230,278},{20,21,
                23,31,32,43,38,39,42,45,47,48,54,55,56,73,62,68,69,70,71,75,76,77,79,83,85,
                87,94,95,96,97,101,102,103,104,106,108,109,110,115,117,121,134,137,141,142,143,
                144,145,147,148,151,152,153,154,157,158,159,161,169,170,171,173,178,225,230,233,
                278},{15,27,28,30,32,34,37,38,39,40,45,46,47,48,52,55,57,58,59,62,63,65,68,
                69,74,75,76,78,125,81,83,84,97,99,102,103,104,109,110,115,116,117,118,121,127,
                128,130,134,135,140,144,146,149,150,151,152,154,157,159,160,168,170,172,210,221,
                225,226,230,260,268,275,278},{20,21,31,33,34,36,37,38,40,41,42,44,45,47,50,51,
                52,53,54,55,56,59,62,65,67,68,69,74,76,77,82,85,86,94,95,99,101,102,104,112,
                109,111,113,115,116,118,121,126,128,134,135,140,141,142,143,145,146,150,152,154,
                157,158,161,163,167,170,171,221,278},{24,62,63,64,80,89,90,92,93,94,107,120,
                132,136,141,147,151},{21,22,30,32,33,40,41,42,48,53,54,55,59,62,63,65,69,74,
                76,77,82,84,86,87,95,99,101,102,104,115,116,118,121,126,128,134,135,140,145,
                147,148,152,153,160,167,221,233,278},{24,31,32,38,45,55,56,61,64,66,67,68,70,
                71,75,76,77,83,92,93,97,101,103,104,117,120,121,132,134,136,141,143,144,146,
                147,149,152,154,157,158,159,165,225,230,278},{19,20,21,23,25,28,32,33,37,39,40,
                41,42,45,46,48,49,51,52,53,54,55,56,59,61,62,64,65,66,67,68,69,71,75,76,77,
                78,79,80,81,86,87,91,94,95,96,101,102,103,104,105,106,107,108,109,111,115,117,
                120,121,124,126,127,128,131,134,135,137,138,140,141,142,143,145,146,147,148,150,
                151,153,154,158,161,165,166,169,170,171,173,225,227,233,278},{19,21,25,32,35,38,
                39,40,41,42,48,51,52,54,64,66,67,71,76,78,80,81,89,90,91,94,95,96,101,102,
                103,105,106,107,109,115,121,126,131,138,141,142,143,145,146,150,152,158,161,167,
                171,176,227,233,278},{21,31,33,36,43,38,45,47,48,53,55,56,57,62,63,65,67,68,
                70,71,74,75,76,77,79,84,95,101,102,104,112,108,110,113,115,117,121,128,131,134,
                135,137,141,142,143,144,146,147,148,151,152,156,157,158,166,170,201,230},{3,4,6,
                17,104,162,164,182,185,188,189,196,202,245,277},{23,48,56,61,89,92,117,127,129,
                142,143,145,154,158,159,174,227,278},{21,31,32,34,43,38,53,54,55,56,73,63,66,
                68,69,71,75,76,77,79,83,85,87,94,95,101,104,112,108,110,115,117,121,134,141,
                142,143,145,146,147,148,151,154,158,165,170,225,230,278},{21,23,31,32,43,38,39,
                41,42,45,48,52,54,55,56,61,62,63,65,68,71,75,76,77,78,79,83,85,87,94,95,96,
                97,99,101,103,104,105,107,109,110,111,115,117,119,121,122,124,127,128,134,137,
                138,141,142,143,144,145,146,148,151,152,153,154,156,157,159,165,166,167,168,170,
                171,221,225},{21,30,32,43,38,45,48,55,62,63,75,76,77,78,79,83,84,85,92,94,
                103,104,110,111,115,117,119,121,129,134,142,143,145,146,147,151,156,158,167,170,
                175,176,177,178,189,226,230,278},{30,41,48,56,62,65,78,82,86,102,115,119,121,
                122,147,150,165,169,173},{20,21,39,48,51,52,54,62,71,75,76,87,94,95,101,108,
                115,117,119,121,141,143,146,148,152,153,227,278},{0,3,4,18,155,164,182,189,196,
                245},{20,21,78,91,92,93,94,97,100,107,120,121,122,132,148,178},{3,4,134,155,
                162,182,189,196,218,245,277},{21,30,31,32,35,39,40,42,45,48,54,59,62,67,71,75,
                76,77,79,89,92,95,108,110,115,117,119,121,132,138,141,142,143,151,152,157,158,
                160,169,170,225,278},{20,21,32,37,38,48,54,56,57,61,63,65,68,72,76,78,83,84,
                94,101,104,112,107,115,120,134,143,145,152,154,158,167,174,201},{19,21,27,28,32,
                39,40,41,45,48,49,54,56,63,64,65,66,76,84,94,99,104,122,135,143,148,150,153,
                158,159,166,171,233},{30,46,48,62,78,89,104,109,127,147,158},{5,30,48,62,86,
                135,146,152,160,165,173,225},{20,21,31,32,43,38,44,45,47,48,54,55,73,68,71,75,
                76,77,79,85,95,97,101,108,110,115,117,119,121,134,138,141,142,143,145,146,147,
                148,152,154,157,158,159,165,225,230},{20,21,32,39,40,42,45,49,52,54,56,63,64,
                65,71,76,83,89,90,94,96,101,107,111,115,121,127,141,143,145,146,148,152,153,
                158,167,230},{15,24,30,48,57,62,63,65,103,104,136,147,181,194,209,210,214,221,
                223,260,263,268,275},{48,58,62,71,86,115,146,152,160,169,225},{5,23,30,60,61,
                91,98,112,114,121,127,156,166,175},{92,176,178,159,174},{19,85,104,129,139,153,
                175,159,177,178,278},{104,129,139,159,176,178},{21,26,42,76,89,90,91,92,94,104,
                109,120,121,132,145,146,175,159,163,176,177,278},{10,14,198,215,216,219,228,237,
                246,255,269},{14,184,195,203,243,262,267,269},{15,172,185,194,210},{0,3,4,8,17,
                18,22,104,155,162,164,183,188,196,202,245,277},{3,4,8,17,18,182,185,186,188,
                196,200,202,211,218,271,277},{180,243},{3,4,6,8,17,18,155,181,183,186,188,189,
                196,218,245,277},{3,4,18,104,183,185,189,196,245},{14,190,197,205,212,224,229,
                231,240,248,254,274},{0,4,6,8,17,18,155,182,183,185,189,196,202,211,218,271},
                {3,4,17,18,104,155,159,162,164,185,186,188,196,202,218,245,277},{14,187,197,199,
                205,207,212,213,229,231,236,238,240,248,253,254,256},{62,192,204,217,232,235,239,
                241,244,250,252,279},{191,204,217,232,235,241,244,250},{5,10,30,35},{15,48,172,
                181,210,214},{180,203},{3,4,6,8,9,17,18,104,155,162,164,182,183,185,186,188,
                189,202,211,218,245,271},{14,187,190,199,205,207,212,213,220,224,229,231,236,238,
                240,248,253,254,257,274},{14,30,179,215,216,219,228,237,246,269},{190,197,205,
                224,229,254,274},{0,4,17,183,202,211,218,234},{20,21,39,54,56,63,125,101,134,
                145,154,166},{0,3,4,6,8,17,18,22,104,155,182,183,188,189,196,200,211,218,271,
                277},{180,195,243,267},{191,192,232},{14,16,187,190,197,199,207,212,213,220,224,
                229,231,236,240,248,253,254,257,274},{2,14,207,208},{2,13,14,48,50,190,197,205,
                206,208,213,224,229,231,236,240,247,248,253,254,257,261,265},{2,14,206,207},{104,
                172,210,223},{15,30,38,46,48,62,63,65,104,109,134,147,172,181,194,209,214,223,
                260,263,268,275,276},{0,3,4,17,18,104,183,188,196,200,202,218,234,245,271},{14,
                187,190,197,205,220,229,238,248,254,274},{14,190,197,205,207,220,229,231,236,238,
                240,248,253,254,256},{15,48,172,194,210},{14,179,198,216,219,228,237,246,269},
                {10,14,30,179,198,215,219,228,237,242,246,255,269},{191,192},{0,3,4,6,7,8,17,
                18,104,164,183,185,188,189,196,200,202,211,245,271},{179,198,215,216,228,237,246,
                269},{197,205,212,213,224,229,238,254,270,273,274},{45,47,48,53,59,62,65,74,76,
                78,81,84,99,104,116,118,121,128,134,135,140,147,148,150,158,172},{50,139},{104,
                172,209,210},{12,14,187,197,199,205,207,220,236,253,273,274},{32,38,45,48,52,55,
                56,62,68,71,75,76,77,78,79,82,86,95,96,101,104,108,110,115,117,121,124,127,
                134,144,146,147,151,152,157,158,165,169,170,173,227,278},{32,48,77,84,104,147,
                159,230},{29,39,42,52,62,67,71,76,94,97,103,114,117,127,137,152,153,156,161,
                225,278},{10,14,30,179,198,215,216,219,237,242,246,255,269},{14,187,190,197,199,
                205,207,212,213,220,231,236,238,240,248,253,254},{21,31,32,35,38,55,73,65,68,
                75,76,77,79,83,101,104,108,110,115,117,134,142,145,146,147,151,154,157,159,170,
                171,226},{187,190,197,205,207,213,229,254},{191,192,204,235,239,241,244,250,279},
                {21,34,35,49,76,79,93,109,121,132,141,144,146,150,152,153,167,278},{0,4,200,
                211},{13,191,192,232,250,252},{14,190,197,205,207,213,224,229,240,248,253,254,
                257},{14,179,198,215,216,219,228,242,269},{14,190,197,212,213,220,229,249,254,
                256,274},{191,232,279},{14,187,190,197,205,207,213,229,236,248,253,254,257,274},
                {191,192,232},{30,216,228,237,269},{1,180,184,203,262,267},{191,192,232,279},{3,
                4,6,8,9,104,155,162,164,182,185,186,189,196,211,218,277},{10,14,179,198,215,
                216,219,228,255,269},{207,261,265},{14,187,190,197,205,207,212,213,229,236,240,
                254,274},{238,261,265,274},{191,192,232,235,252,269},{257},{191,235,250},{14,48,
                190,197,205,207,213,224,229,236,240,254,257},{14,187,190,197,199,205,207,212,213,
                220,229,231,236,238,240,248,253,257},{14,179,216,228,246,269},{190,213,238},{14,
                251,197,205,207,236,240,253,254},{259,266,272},{258,266,272},{15,48,147,172,210,
                268,275},{207,247,249,265},{1,180,243,267},{15,48,62,104,172,210,275,276},{48},
                {207,247,249,261},{258,259,272},{180,203,243,262},{15,48,147,172,210,260},{10,14,
                30,179,180,198,215,216,219,228,237,242,246,250,255},{220,273},{0,4,6,17,18,183,
                188,196,202,211,218},{258,259,266},{220,224,270},{187,197,199,205,212,220,224,238,
                240,248,249},{15,48,147,172,210,260,263},{15,48,104,210,263},{3,4,6,7,155,164,
                182,183,185,189,202,245},{20,21,23,24,26,27,29,30,31,32,37,41,42,46,48,51,52,
                54,55,59,61,65,67,69,71,72,75,76,77,79,80,81,83,87,89,90,91,92,94,95,99,101,
                102,103,104,105,106,112,107,109,111,113,115,117,121,127,129,130,131,132,134,137,
                138,141,142,145,146,147,148,150,151,152,153,156,157,159,161,165,176,178,225,227,
                233},{191,232,239,244}};


        philGraph = new AdjacencyGraph(philAdjacencyGraph.length);
        for(int i = 0; i < philAdjacencyGraph.length; i++){
            for(int connectionInt : philAdjacencyGraph[i]){
                philGraph.addEdge(i, connectionInt);
            }
        }
        dylanGraph = new AdjacencyGraph(dylanAdjacencyGraph.length);
        for(int i = 0; i < dylanAdjacencyGraph.length; i++){
            for(int connectionInt : dylanAdjacencyGraph[i]){
                dylanGraph.addEdge(i, connectionInt);
            }
        }

    }

    @Test
    public void checkMediumUserSpeedWithOneThreadOneRequest(){
        ThreadPoolExecutor executor = new ThreadPoolExecutor(1, 1, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
        try{
        BetweennessCentrality centrality = new BetweennessCentrality(executor);

        //warm up JVM
        int i = 0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(philGraph);
            i++;
        }

        // begin timing
        long timeBefore = System.currentTimeMillis();
        i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(philGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest = (double) ((double)timeTaken) / 1000d;
        System.out.println("For 1 thread and 1 request at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a medium user");
        }finally {
            executor.shutdownNow();
        }
    }

    @Test
    public void checkMediumUserSpeedWithOneThreadManyRequests() throws InterruptedException {

        ThreadPoolExecutor executor = new ThreadPoolExecutor(1, 1, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
        try{
            BetweennessCentrality centrality = new BetweennessCentrality(executor);

            final LoadRunner runner = new LoadRunner(4, 1, philGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(10*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(philGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 100d;
        System.out.println("For 1 thread and 4 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a medium user");

        runner.stop();
        }finally {
            executor.shutdownNow();
        }
    }

    @Test
    public void checkMediumUserSpeedWithTwoThreadsManyRequests() throws InterruptedException {

            ThreadPoolExecutor executor = new ThreadPoolExecutor(1, 1, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
            try{
                BetweennessCentrality centrality = new BetweennessCentrality(executor);

                final LoadRunner runner = new LoadRunner(4, 2, philGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(5*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(philGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 100d;
        System.out.println("For 2 thread and 4 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a medium user");

        runner.stop();
            }finally {
                executor.shutdownNow();
            }
    }

    @Test
    @Ignore
    public void checkMediumUserSpeedWithFourThreadsManyRequests() throws InterruptedException {

                ThreadPoolExecutor executor = new ThreadPoolExecutor(4, 4, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
                try{
                    BetweennessCentrality centrality = new BetweennessCentrality(executor);

                    final LoadRunner runner = new LoadRunner(4, 4, philGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(5*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 1000){
            double[] result = centrality.calculateCentrality(philGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 1000d;
        System.out.println("For 4 thread and 4 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a medium user");

        runner.stop();
                }finally {
                    executor.shutdownNow();
                }
    }
    @Test
    public void checkLargeUserSpeedWithOneThreadOneRequest(){
                    ThreadPoolExecutor executor = new ThreadPoolExecutor(8, 8, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
                    try{
                        BetweennessCentrality centrality = new BetweennessCentrality(executor);


                        //warm up JVM
        int i = 0;
        while(i < 10){
            double[] result = centrality.calculateCentrality(dylanGraph);
            i++;
        }

        // begin timing
        long timeBefore = System.currentTimeMillis();
        i=0;
        while(i < 10){
            double[] result = centrality.calculateCentrality(dylanGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest = (double) ((double)timeTaken) / 10d;
        System.out.println("For 1 thread and 1 request at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a large user");
                    }finally {
                        executor.shutdownNow();
                    }
    }

    @Test
    public void checkLargeUserSpeedWithOneThreadManyRequests() throws InterruptedException {

                        ThreadPoolExecutor executor = new ThreadPoolExecutor(1, 1, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
                        try{
                            BetweennessCentrality centrality = new BetweennessCentrality(executor);

                            final LoadRunner runner = new LoadRunner(4, 1, dylanGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(10*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(dylanGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 100d;
        System.out.println("For 1 thread and 10 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a large user");

        runner.stop();
                        }finally {
                            executor.shutdownNow();
                        }
    }

    @Test
    public void checkLargeUserSpeedWithTwoThreadsManyRequests() throws InterruptedException {

                            ThreadPoolExecutor executor = new ThreadPoolExecutor(2, 2, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
                            try{
                                BetweennessCentrality centrality = new BetweennessCentrality(executor);
                                final LoadRunner runner = new LoadRunner(4, 2, dylanGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(5*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(dylanGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 100d;
        System.out.println("For 2 thread and 10 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a large user");

        runner.stop();
                            }finally {
                                executor.shutdownNow();
                            }
    }

    @Test
    public void checkLargeUserSpeedWithFourThreadsManyRequests() throws InterruptedException {

                                ThreadPoolExecutor executor = new ThreadPoolExecutor(4, 4, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
                                try{
                                    BetweennessCentrality centrality = new BetweennessCentrality(executor);
                                    final LoadRunner runner = new LoadRunner(4, 4, dylanGraph);
        new Thread(runner).start();
        // warm up JVM
        Thread.sleep(5*1000);
        // begin timing
        long timeBefore = System.currentTimeMillis();
        int i=0;
        while(i < 100){
            double[] result = centrality.calculateCentrality(dylanGraph);
            i++;
        }
        long timeTaken = System.currentTimeMillis() - timeBefore;
        double timeTakenPerRequest =  ((double)timeTaken) / 100d;
        System.out.println("For 4 thread and 10 requests at a time, it took "+ timeTakenPerRequest + " to calculate" +
                " centrality on this hardware for a large user");

        runner.stop();
                                }finally {
                                    executor.shutdownNow();
                                }
    }
    @After
    public void tearDown() throws Exception {

    }

    private class CentralityCallable implements Callable<double[]> {
        private final BetweennessCentrality centrality;
        private final AdjacencyGraph graph;

        public CentralityCallable(BetweennessCentrality centrality, AdjacencyGraph graph) {
            this.centrality = centrality;
            this.graph = graph;
        }

        @Override
        public double[] call() throws Exception {
            double[] result = centrality.calculateCentrality(graph);
            return result;
        }
    }

    private class LoadRunner implements Runnable{

        private final int loadThreads;
        private final int threadsPerRequest;
        private final AdjacencyGraph graph;
        private boolean shouldStop = false;

        private LoadRunner(int loadThreads, int threadsPerRequest, AdjacencyGraph graph) {
            this.loadThreads = loadThreads;
            this.threadsPerRequest = threadsPerRequest;
            this.graph = graph;
        }

        @Override
        public void run() {
            ThreadPoolExecutor executor1 = new ThreadPoolExecutor(threadsPerRequest, threadsPerRequest, 1, TimeUnit.SECONDS, new LinkedBlockingDeque<Runnable>());
            try{
            final BetweennessCentrality centrality = new BetweennessCentrality(executor1);
            ExecutorService executor = Executors.newFixedThreadPool(loadThreads);
            List<Future<double[]>> futures = new ArrayList<>(loadThreads);
            for(int i = 0; i < loadThreads; i++){
                futures.add(executor.submit(new CentralityCallable(centrality, graph)));
            }
            while(!shouldStop){
                Iterator<Future<double[]>> iter = futures.iterator();
                List toAdd = new ArrayList();
                int futuresDestroyed = 0;
                while(iter.hasNext() && !shouldStop){
                    Future<double[]> next = iter.next();
                    if(next.isDone()){
                        toAdd.add(executor.submit(new CentralityCallable(centrality, graph)));
                        iter.remove();
                        futuresDestroyed++;
                    }
                }
                if(futuresDestroyed==0) try {
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                futures.addAll(toAdd);

            }
            for(Future<double[]> future : futures){
                future.cancel(true);
            }
            executor.shutdownNow();
            }finally {
            executor1.shutdownNow();
        }
        }
        public void stop(){
            shouldStop = true;
        }
    }
}
